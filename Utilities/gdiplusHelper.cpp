#include "StdAfx.h"
#include "gdiplusHelper.h"

using namespace Gdiplus;

namespace GdiplusHelper {

CString GetActualDisplayText(const CString& display_text, Graphics& graphics, Gdiplus::Font& font, StringFormat& fomat, LONG Width)
{
	CString full_text = display_text;

	RectF bound_rect;
	PointF point(0, 0);
	graphics.MeasureString(CT2CW(full_text), full_text.GetLength(), &font, point, &fomat, &bound_rect);
	if (bound_rect.Width <= Width)
	{
		return full_text;
	}

	CString actual_display_text;
	int hidden_character_count  = 3;
	while (bound_rect.Width > Width && hidden_character_count < full_text.GetLength())
	{
		CString remaining_string = full_text.Left(full_text.GetLength() - hidden_character_count);
		if (remaining_string.Right(1) == _T(' '))
		{
			++hidden_character_count;
			continue;
		}
		actual_display_text = full_text.Left(full_text.GetLength() - hidden_character_count) + _T("...");
		graphics.MeasureString(CT2CW(actual_display_text), actual_display_text.GetLength(),
			&font, point, &fomat, &bound_rect);
		++hidden_character_count;
	}

	return actual_display_text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ;
}

}